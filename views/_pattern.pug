mixin pattern(product)
  div.row
    div.col-md-8.mt-5
      div.card
        h2.card-header
          = product.title
        div#latest.card-body
          if product.images && product.images.length > 0
            // Main image
            div.mb-3
              img#mainImage.img-fluid(src=product.images[0].url, alt=product.images[0].altText, style="max-width: 100%; cursor: pointer;")
            // Thumbnail gallery
            if product.images.length > 1
              div.d-flex.flex-wrap.gap-2
                each image, index in product.images
                  img.thumbnail-img(
                    src=image.url, 
                    alt=image.altText, 
                    style=`width: 80px; height: 80px; object-fit: cover; cursor: pointer; border: 2px solid ${index === 0 ? '#007bff' : 'transparent'};`
                    onclick=`document.getElementById('mainImage').src='${image.url}'; document.querySelectorAll('.thumbnail-img').forEach(img => img.style.border='2px solid transparent'); this.style.border='2px solid #007bff';`
                  )
          else if product.square_thumbnail_url
            img.img-fluid(src=product.square_thumbnail_url, alt=product.title)
          br
          if product.descriptionHtml
            != product.descriptionHtml.replace(/\n/g, '<br>')
          else if product.description
            p!= product.description.replace(/\n/g, '<br>')
          else
            p No description available
    div.col-md-4.mt-5
      if product.etsyUrl
        div.card.mb-3
          div.card-body.text-center
            a.btn.btn-primary.btn-lg(
              href=product.etsyUrl,
              target="_blank",
              rel="noopener noreferrer",
              style="width: 100%;"
            )
              i.fas.fa-shopping-cart.me-2
              | Buy on Etsy
            small.text-muted.d-block.mt-2 Opens in new window
      div.card
        div#latest.card-body
          div
            if product.productType
              p
                strong Product Type: 
                = product.productType
            if product.vendor
              p
                strong Vendor: 
                = product.vendor
            if product.sku
              p
                strong SKU: 
                = product.sku
            if product.tags && product.tags.length > 0
              p
                strong Tags:
                br
                each tag in product.tags
                  a.badge.rounded-pill.bg-secondary.me-1.text-decoration-none(
                    href=`/tags/${encodeURIComponent(tag)}`,
                    style="color: white;"
                    onmouseover="this.style.backgroundColor='#495057'"
                    onmouseout="this.style.backgroundColor='#6c757d'"
                  )
                    = tag
            if product.priceRange
              p
                strong Price: 
                = product.priceRange.minVariantPrice.currencyCode + " " + product.priceRange.minVariantPrice.amount
            if product.availableForSale
              p.text-success Available for Sale
            else
              p.text-danger Out of Stock
            if product.etsyUrl
              p
                strong Buy this pattern: 
                a(href=product.etsyUrl, target="_blank", rel="noopener noreferrer")
                  | View on Etsy â†—
              
      if product.variants && product.variants.length > 0
        div.card
          h2.card-header
              = "Variants"
          div#variants.card-body
            div
              each variant in product.variants
                div.mb-2
                  p
                    strong= variant.title
                    if variant.sku
                      br
                      small.text-muted SKU: #{variant.sku}
                    br
                    = variant.price.currencyCode + " " + variant.price.amount
                    if variant.availableForSale
                      span.badge.bg-success.ms-2 Available
                    else
                      span.badge.bg-danger.ms-2 Out of Stock

      if product.reviews && product.reviews.totalReviews > 0
        div.card.mt-3
          h2.card-header
            i.fas.fa-star.text-warning.me-2
            = "Customer Reviews"
            span.badge.bg-primary.ms-2= product.reviews.totalReviews
          div.card-body
            div.row.mb-3
              div.col-md-6
                div.d-flex.align-items-center.mb-2
                  div.me-3
                    span.h4.mb-0= product.reviews.averageRating.toFixed(1)
                    small.text-muted /5.0
                  div
                    - for (let i = 1; i <= 5; i++)
                      if i <= Math.floor(product.reviews.averageRating)
                        i.fas.fa-star.text-warning
                      else if i - 0.5 <= product.reviews.averageRating
                        i.fas.fa-star-half-alt.text-warning
                      else
                        i.far.fa-star.text-muted
              div.col-md-6
                small.text-muted Based on #{product.reviews.totalReviews} review#{product.reviews.totalReviews === 1 ? '' : 's'}
                
            // Rating breakdown
            div.mb-3
              - var ratings = Object.keys(product.reviews.summary).sort((a, b) => b - a)
              each rating in ratings
                - var count = product.reviews.summary[rating]
                - var percentage = product.reviews.totalReviews > 0 ? (count / product.reviews.totalReviews * 100) : 0
                div.row.align-items-center.mb-1
                  div.col-2
                    small #{rating} stars
                  div.col-8
                    div.progress(style="height: 6px;")
                      div.progress-bar.bg-warning(style=`width: ${percentage}%`)
                  div.col-2.text-end
                    small.text-muted= count
            
            // Recent reviews
            if product.reviews.reviews && product.reviews.reviews.length > 0
              hr
              h6 Recent Reviews:
              div.reviews-list(style="max-height: 400px; overflow-y: auto;")
                each review, index in product.reviews.reviews.slice(0, 5)
                  div.border-bottom.pb-2.mb-2
                    div.d-flex.justify-content-between.align-items-start.mb-1
                      div
                        - for (let i = 1; i <= 5; i++)
                          if i <= review.rating
                            i.fas.fa-star.text-warning.small
                          else
                            i.far.fa-star.text-muted.small
                        span.ms-2.small.text-muted by #{review.buyerDisplayName}
                      if review.reviewDate
                        small.text-muted= new Date(review.reviewDate).toLocaleDateString()
                    if review.review
                      p.mb-0.small= review.review
                    if review.translatedReview && review.translatedReview !== review.review
                      p.mb-0.small.text-muted.fst-italic Translated: #{review.translatedReview}
